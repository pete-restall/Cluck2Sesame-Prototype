	#ifndef __CLUCK2SESAME_UI_STATES_INC
	#define __CLUCK2SESAME_UI_STATES_INC
	#include "Platform.inc"

	radix decimal

	.module UI

UI_STATE_BOOT equ 0x00
UI_STATE_WAKEUP equ 0x01
UI_STATE_WAIT_LCDIDLE equ 0x02
UI_STATE_SETTINGS_BACKLIGHTNOW equ 0x03
UI_STATE_SETTINGS_BACKLIGHTNOW_LEFT equ 0x04
UI_STATE_SETTINGS_BACKLIGHTNOW_RIGHT equ 0x05
UI_STATE_SETTINGS_BACKLIGHTNOW_ENTER equ 0x06
UI_STATE_WAIT_BUTTONPRESS equ 0x07
UI_STATE_WAIT_BUTTONPRESS2 equ 0x08
UI_STATE_SLEEP equ 0x09
UI_STATE_OPTION_CHANGED equ 0x0a
UI_STATE_OPTION_CHANGED2 equ 0x0b
UI_STATE_OPTION_CHANGED3 equ 0x0c
UI_STATE_SETTINGS_BACKLIGHTINTHEDARK equ 0x0d
UI_STATE_SETTINGS_BACKLIGHTINTHEDARK_LEFT equ 0x0e
UI_STATE_SETTINGS_BACKLIGHTINTHEDARK_RIGHT equ 0x0f
UI_STATE_SETTINGS_BACKLIGHTINTHEDARK_ENTER equ 0x10
UI_STATE_SETTINGS_DATETIME equ 0x11
UI_STATE_SETTINGS_DATETIME_LEFT equ 0x12
UI_STATE_SETTINGS_DATETIME_RIGHT equ 0x13
UI_STATE_SETTINGS_DATETIME_ENTER equ 0x14
UI_STATE_SETTINGS_OPENCLOSEOFFSETS equ 0x15
UI_STATE_SETTINGS_OPENCLOSEOFFSETS_LEFT equ 0x16
UI_STATE_SETTINGS_OPENCLOSEOFFSETS_RIGHT equ 0x17
UI_STATE_SETTINGS_OPENCLOSEOFFSETS_ENTER equ 0x18
UI_STATE_SETTINGS_LOCATION equ 0x19
UI_STATE_SETTINGS_LOCATION_LEFT equ 0x1a
UI_STATE_SETTINGS_LOCATION_RIGHT equ 0x1b
UI_STATE_SETTINGS_LOCATION_ENTER equ 0x1c
UI_STATE_SETTINGS_DOORCALIBRATION equ 0x1d
UI_STATE_SETTINGS_DOORCALIBRATION_LEFT equ 0x1e
UI_STATE_SETTINGS_DOORCALIBRATION_RIGHT equ 0x1f
UI_STATE_SETTINGS_DOORCALIBRATION_ENTER equ 0x20
UI_STATE_SETTINGS_DOORCALIBRATION_RAISING equ 0x21
UI_STATE_SETTINGS_DOORCALIBRATION_LOWERING equ 0x22
UI_STATE_HOME equ 0x23
UI_STATE_HOME_LEFT equ 0x24
UI_STATE_HOME_RIGHT equ 0x25
UI_STATE_HOME_ENTER equ 0x26
UI_STATE_DOOROVERRIDE equ 0x27
UI_STATE_DOOROVERRIDE_LEFT equ 0x28
UI_STATE_DOOROVERRIDE_RIGHT equ 0x29
UI_STATE_DOOROVERRIDE_ENTER equ 0x2a
UI_STATE_VERSION equ 0x2b
UI_STATE_VERSION_LEFT equ 0x2c
UI_STATE_VERSION_RIGHT equ 0x2d
UI_STATE_VERSION_ENTER equ 0x2e
UI_STATE_ADJUSTSETTINGS equ 0x2f
UI_STATE_ADJUSTSETTINGS_LEFT equ 0x30
UI_STATE_ADJUSTSETTINGS_RIGHT equ 0x31
UI_STATE_ADJUSTSETTINGS_ENTER equ 0x32
UI_STATE_BCD_PUTSTRING equ 0x33
UI_STATE_BCD_MOVE equ 0x34
UI_STATE_BCD_PUT equ 0x35
UI_STATE_WAIT_UNTILCANSLEEP equ 0x36
UI_STATE_ASLEEP equ 0x37

UI_STATE_LAST equ UI_STATE_ASLEEP

UI_STATE_SETTINGS equ UI_STATE_SETTINGS_BACKLIGHTNOW

	.externalVariable uiState
	.externalVariable uiNextState

	#ifndef __CLUCK2SESAME_UI_POLL_ASM
	extern pollNextInChainAfterUi
	#endif

setUiState macro state
	.setBankFor uiState
	movlw state
	movwf uiState
	endm

setUiNextState macro state
	.setBankFor uiNextState
	movlw state
	movwf uiNextState
	endm

waitForLcdIdleThen macro state
	setUiState UI_STATE_WAIT_LCDIDLE
	setUiNextState state
	endm

defineUiStateInSameSection macro name
	global uiState#v(name)

uiState#v(name):
	.knownBank uiState
	endm

defineUiState macro name
Ui code
	defineUiStateInSameSection name
	endm

defineUiStateTableEntry macro i
	if (i <= UI_STATE_LAST)
		extern uiState#v(i)
		goto uiState#v(i)
		defineUiStateTableEntry i + 1
	endif
	endm

createUiStateTable macro
	defineUiStateTableEntry 0
	endm

returnFromUiState macro
	goto pollNextInChainAfterUi
	endm

	#endif
